<!-- 
<nav class="navbar-clinica">
  <div class="logo">
    <img src="assets/images/icono.ico" alt="Cl√≠nica" />
    <div class="titulo-logo">
      <h2>Cl√≠nica OnLine</h2>
      <span>Especialistas en Salud</span>
    </div>
  </div>
<ul class="navbar-links">
  <li><button (click)="toggleVista(false)">Mis Turnos</button></li>
  <li><button (click)="toggleVista(true)">Mi Perfil</button></li>
  <li><button class="logout-btn" (click)="logout()">Cerrar sesi√≥n</button></li>
</ul>
</nav>


<div *ngIf="mostrarPerfil">
<div class="perfil-container" *ngIf="userData">
  <h2>Mi Perfil</h2>
  <img [src]="userData.fotoPerfil" alt="Foto de perfil" class="foto-perfil" />

  <div class="datos-usuario">
    <p><strong>Nombre:</strong> {{ userData.nombre }}</p>
    <p><strong>Apellido:</strong> {{ userData.apellido }}</p>
    <p><strong>Edad:</strong> {{ userData.edad }}</p>
    <p><strong>DNI:</strong> {{ userData.dni }}</p>
    <p><strong>Mail:</strong> {{ userData.mail }}</p>
  </div>

<div class="horarios-wrapper">
  <h2>Mis Horarios</h2>

  <div *ngFor="let h of horarios; let i = index" class="horario-row">
<select [(ngModel)]="h.especialidad" class="campo">
  <option value="" disabled>Seleccione una especialidad</option>
  <option *ngFor="let esp of especialidades" [value]="esp">{{ esp }}</option>
</select>


    <select [(ngModel)]="h.duracion" class="campo">
      <option [value]="30">30 minutos</option>
      <option [value]="60">60 minutos</option>
    </select>

  <input type="date" [(ngModel)]="h.fecha" class="campo" />


    <select [(ngModel)]="h.horaInicio" class="campo">
      <option value="" disabled selected>Inicio</option>
      <option *ngFor="let hora of horas" [value]="hora">{{ hora }}</option>
    </select>

    <select [(ngModel)]="h.horaFin" class="campo">
      <option value="" disabled selected>Fin</option>
      <option *ngFor="let hora of horas" [value]="hora">{{ hora }}</option>
    </select>

    <button type="button" class="btn-borrar" (click)="eliminarHorario(i)">üóëÔ∏è</button>
  </div>

  <div class="acciones-horarios">
    <button type="button" class="btn-agregar" (click)="agregarHorario()">‚ûï Agregar horario</button>
    <button type="button" class="btn-guardar" (click)="guardarHorarios()">Guardar horarios</button>
  </div>
</div>
</div>
</div>

<div *ngIf="!mostrarPerfil">
<div class="filtros">
  <h3>Filtrar por Especialidad:</h3>
  <button *ngFor="let esp of especialidadesUnicas"
          [class.selected]="filtroEspecialidad === esp"
          (click)="filtroEspecialidad = esp; aplicarFiltros()">
    {{ esp }}
  </button>
  <button *ngIf="filtroEspecialidad" (click)="filtroEspecialidad = null; aplicarFiltros()">Quitar filtro</button>

  <h3>Filtrar por Paciente:</h3>
  <button *ngFor="let p of pacientesUnicos"
          [class.selected]="filtroPaciente === p"
          (click)="filtroPaciente = p; aplicarFiltros()">
    {{ p }}
  </button>
  <button *ngIf="filtroPaciente" (click)="filtroPaciente = null; aplicarFiltros()">Quitar filtro</button>
</div>
<div *ngIf="turnosFiltrados.length === 0" class="no-turnos">
  <p>No hay turnos para mostrar.</p>
</div>



<div *ngFor="let turno of turnosFiltrados"
     class="turno-card" 
     [attr.data-estado]="turno.estado?.toLowerCase()">

  <div class="turno-linea">
    <span class="campo"><strong>Especialista:</strong> {{ turno.especialista }}</span>
    <span class="campo"><strong>Especialidad:</strong> {{ turno.especialidad }}</span>
  </div>

  <div class="turno-linea">
    <span class="campo"><strong>Fecha:</strong> {{ turno.fecha }} - {{ turno.hora }}</span>
    <span class="campo">
      <strong>Estado:</strong>
      <span class="pill" [ngClass]="turno.estado.toLowerCase()">{{ turno.estado }}</span>
    </span>
  </div>

  <div class="acciones">
    <button *ngIf="puedeAceptar(turno.estado)" class="btn btn-aceptar" (click)="aceptarTurno(turno)">Aceptar</button>
    <button *ngIf="puedeRechazar(turno.estado)" class="btn btn-rechazar" (click)="rechazarTurno(turno)">Rechazar</button>
    <button *ngIf="puedeCancelar(turno.estado)" class="btn btn-cancelar" (click)="cancelarTurno(turno)">Cancelar turno</button>
    <button *ngIf="turno.estado === 'aceptado'" class="btn btn-finalizar" (click)="finalizarTurno(turno)">Finalizar</button>
    <button *ngIf="turno.comentarioEspecialista" class="btn btn-rese√±a" (click)="verResena(turno)">Ver rese√±a</button>
  </div>
</div>


</div> -->
<nav class="navbar-clinica">
  <div class="logo">
    <img src="assets/images/icono.ico" alt="Cl√≠nica" />
    <div class="titulo-logo">
      <h2>Cl√≠nica OnLine</h2>
      <span>Especialistas en Salud</span>
    </div>
  </div>
  <ul class="navbar-links">
    <li><button (click)="toggleVista(false)">Mis Turnos</button></li>
    <li><button (click)="toggleVista(true)">Mi Perfil</button></li>
    <li><button (click)="goTo('historias-clinicas-especialista')">Pacientes</button></li>
    <li><button class="logout-btn" (click)="logout()">Cerrar sesi√≥n</button></li>
  </ul>
</nav>

<!-- PERFIL -->
<div *ngIf="mostrarPerfil">
  <div class="perfil-container" *ngIf="userData">
    <h2>Mi Perfil</h2>
    <img [src]="userData.fotoPerfil" alt="Foto de perfil" class="foto-perfil" />
    <div class="datos-usuario">
      <p><strong>Nombre:</strong> {{ userData.nombre }}</p>
      <p><strong>Apellido:</strong> {{ userData.apellido }}</p>
      <p><strong>Edad:</strong> {{ userData.edad }}</p>
      <p><strong>DNI:</strong> {{ userData.dni }}</p>
      <p><strong>Mail:</strong> {{ userData.mail }}</p>
    </div>

    <!-- Horarios -->
    <div class="horarios-wrapper">
      <h2>Disponibilidad por especialidad</h2>

      <div *ngFor="let h of horarios; let i = index" class="horario-row">
        <select [(ngModel)]="h.especialidad" class="campo">
          <option value="" disabled selected>Seleccionar especialidad</option>
          <option *ngFor="let esp of especialidades" [value]="esp">
  {{ formatearEspecialidad(esp) }}
</option>
        </select>

        <select [(ngModel)]="h.dia" class="campo" [disabled]="!h.especialidad">
          <option value="" disabled selected>Seleccionar d√≠a</option>
          <option *ngFor="let dia of diasSemana" [value]="dia">{{ dia }}</option>
        </select>

        <select [(ngModel)]="h.horaInicio" class="campo" [disabled]="!h.especialidad">
          <option value="" disabled selected>Desde</option>
          <option *ngFor="let hora of horas" [value]="hora">{{ hora }}</option>
        </select>

        <select [(ngModel)]="h.horaFin" class="campo" [disabled]="!h.especialidad">
          <option value="" disabled selected>Hasta</option>
          <option *ngFor="let hora of horas" [value]="hora">{{ hora }}</option>
        </select>

        <select [(ngModel)]="h.duracion" class="campo" [disabled]="!h.especialidad">
          <option [value]="30">30 minutos</option>
          <option [value]="60">60 minutos</option>
        </select>

        <button type="button" class="btn-borrar" (click)="eliminarHorario(i)">üóëÔ∏è</button>
      </div>

      <div class="acciones-horarios">
        <button type="button" class="btn-agregar" (click)="agregarHorario()">‚ûï Agregar disponibilidad</button>
        <button type="button" class="btn-guardar" (click)="guardarHorarios()">Guardar horarios</button>
      </div>
    </div>
  </div>
</div>

<!-- MIS TURNOS -->
<div *ngIf="!mostrarPerfil">
  <!-- Filtros -->
<div class="filtros">
  <label><strong>üîç Buscar por cualquier dato:</strong></label>
  <input [(ngModel)]="busquedaLibre" (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." />
</div>


  <!-- Lista de turnos -->
  <div class="lista-turnos" *ngIf="turnosFiltrados.length; else sinTurnos">
<div class="turno-card" *ngFor="let turno of turnosFiltrados" [attr.data-estado]="turno.estado">
  <p><strong>Paciente:</strong> {{ turno.nombrePaciente }}</p>
  <p><strong>Especialidad:</strong> {{ turno.especialidad }}</p>
  <p><strong>Fecha:</strong> {{ turno.fecha | date:'dd/MM/yyyy' }}</p>
  <p><strong>Hora:</strong> {{ turno.hora }}</p>
  <p><strong>Estado:</strong> {{ turno.estado }}</p>

<button 
  *ngIf="turno.estado === 'realizado'" 
  class="boton-historia" 
  (click)="mostrarHistoria[turno.id] = !mostrarHistoria[turno.id]">
  <i class="fas fa-dna"></i> 
  {{ mostrarHistoria[turno.id] ? 'Ocultar Historia Cl√≠nica' : 'Ver Historia Cl√≠nica' }}
</button>


<div *ngIf="mostrarHistoria[turno.id] && turno.historia" class="historia-box">
  <h4>ü©∫ Historia Cl√≠nica</h4>
  <p><strong>Altura:</strong> {{ turno.historia.altura }} cm</p>
  <p><strong>Peso:</strong> {{ turno.historia.peso }} kg</p>
  <p><strong>Presi√≥n:</strong> {{ turno.historia.presion }}</p>
  <p><strong>Temperatura:</strong> {{ turno.historia.temperatura }} ¬∞C</p>

  <ul>
    <li *ngFor="let clave of getClaves(turno.historia.datos_extra)">
      {{ clave }}: {{ turno.historia.datos_extra[clave] }}
    </li>
  </ul>
</div>


  <div class="acciones" *ngIf="
    puedeAceptar(turno.estado) || 
    puedeRechazar(turno.estado) || 
    puedeCancelar(turno.estado) || 
    turno.estado === 'aceptado' || 
    turno.calificacionPaciente
  ">
    <button *ngIf="puedeAceptar(turno.estado)" (click)="aceptarTurno(turno)">Aceptar</button>
    <button *ngIf="puedeRechazar(turno.estado)" (click)="rechazarTurno(turno)">Rechazar</button>
    <button *ngIf="puedeCancelar(turno.estado)" (click)="cancelarTurno(turno)">Cancelar</button>
    <button *ngIf="turno.estado === 'aceptado'" (click)="finalizarTurno(turno)">Finalizar</button>
    <button *ngIf="turno.calificacionPaciente" (click)="verResena(turno)">Ver Rese√±a</button>
    
  </div>
</div>

  </div>

  <!-- Mensaje si no hay turnos -->
  <ng-template #sinTurnos>
    <p>No se encontraron turnos con los filtros seleccionados.</p>
  </ng-template>
</div>
